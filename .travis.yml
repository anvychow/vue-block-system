language: node_js

cache:
  directories:
  - node_modules

node_js:
  - 'stable'

sudo: false

before_install:
  - if [[ `npm -v` != 5* ]]; then npm i -g npm@5; fi
  - npm install -g typings
  - npm install -g codeclimate-test-reporter

script:
  - npm run build
  - npm run validate

after_script:
  - codeclimate-test-reporter < coverage/lcov.info
  - node_modules/.bin/coveralls < coverage/lcov.info

before_deploy:
  - npm run build:dist && node ./script/package-dist.js

deploy:
  provider: npm
  email: 'larsvanbraam@gmail.com'
  api_key:
    secure: 'yxnNS6gX1nUJaUXPJICpJ15QRAdEZ6rE7W1nIVvteD5unknPSyTzHwBXh4EwAJX6022OQy0LtuHfRpm+fMpeZT81n7+KKPB3nFzV7Wqno6CPxE79xVozVHDwhNJHhYWxHjJWR4J1QOu16yOjoLagVaHb816giJiaS55enNqubTeCJXb0Sr67qdb9XmiB90lYXkChkwbsKYBsDkuCJ9FQWMwp3sL46zRSN3KfQqWm0d811sDyYirv4XwD1kMVHz6ToxIT5HtvIKnlZNH06eYsb6Xa4Ssq/2CJGsYP6Dm75sGA1VpWZOIt5f71Wgs0iO96T7RmAqL1FxOAF5npT/uYkrqLYzMqMatKODBvzUZSlVgRrrjCAOBBkPmFHo8E9yX6PvKc01Cpey3d00a4u4PJIFrr9FMGokhCA1AjWrV0XuYzgeTFScj4rz1rJJaBRsU1b+J1Rl08QsGa/eK3G4HONCgXYR/ksAghR6XiXmvUOWEyLU51sxUOntY+DV0/F5M+P9puxyx/S6dBglHLwXK0WxxdV/XsxFbtbyEAJuemPiNwDHVeJ29QH2wsJi3EvedmiXcoDWaUT/2YeKIq8MQHsCRVK5n+f4R6vj8M0QDwfRw2Xxl9mWedgT95DbL0EEMYpUw/YKwIgZsPgsQVkqlSa6wzDMBsQQrMxDXuDd3LKVI="'
  on:
    tags: true
    node: 'stable'
  skip_cleanup: true

addons:
  code_climate:
    repo_token:
      secure: 'ONHyuZ4TqJq07CDYNtF2RU7vM0nBIGd1fPk8MvDbWWOeXvJ5B8bnhmHejW8yxodKZLkKnnDHCWw0GPPYlVwC+NbZLGFPz3vpifcUWlPS0jyL60DiNaMxKQc7bYLFpcoQaKZ2x/QLqIxa25pGH2ivXMaK/P9r2/e17Z9IxDhLu9WPcky6FeRyD5jKYtTQqWQ/COWj0gkMjdJdoDe/9lfWVea+sJUVu57ABx53sgDtNmNvkQPfhfllF2x6ly87G0xjIqItCR6Al4DAAzHf87HRi7EnMdf3rTLga/flrkDXzcZDOoaHqN6l5pQAZQGuzq5ZdudDXDx6+uy6J6WqHG8IXCQEu7NoSQ/OI6LN5gwVgegsK/d/JZk2Kru+0lnTjDmRhCP19Qkgu2++3tEO6CPOXG7WgIULYqsXn3zvit0kSKsYekNnjRYpCyQthivz3gWGX8GS3i6TtamdL83YcOP91QoKie+S4eVmamwuttxFEIaQAz97J1bBtHgMvYgAGoT6YOr0OBKKZ2q+sak2+8KmRIP4PGWrziXMuJoJYZGf6ip7LYkRcy0vNC+piXw7wgNMU+NxytkWvNjo7UoIHlyDh3vxgpP5f940nNsGp4fF0eGdEXd8xgVKVh6QXpWS3dE+KAqKj4Kcog7Z0pIPiJk9Ed49CLwTa3df6bOqGsOqH8A='